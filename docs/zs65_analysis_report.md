# ZS65テーブル分析レポート - T007検証結果

## 📊 分析概要

**分析日時**: 2025-09-18  
**対象テーブル**: zs65  
**分析ツール**: T007検証システム + DB Browser確認

## 🔍 現状確認

### テーブル構造
- **総フィールド数**: 35個
- **TEXT型フィールド**: 35個 (100%)
- **数値型フィールド**: 0個
- **日付型フィールド**: 0個

### Column Master状況
- **data_type**: 全てTEXT
- **initial_inferred_type**: 全てTEXT  
- **エンコーディング**: cp932統一
- **区切り文字**: タブ区切り

## ⚠️ 問題点の特定

### 1. 数値フィールドのTEXT化
以下のフィールドは本来数値型であるべき：

| フィールド名 | 現在の型 | 推奨型 | 理由 |
|-------------|----------|--------|------|
| 利用可能数量 | TEXT | REAL | 在庫数量（小数点あり） |
| 転送中在庫(保管場所内) | TEXT | INTEGER | 在庫数（整数） |
| 積送/積送中の値 | TEXT | INTEGER | 数量（整数） |
| 品質検査中在庫 | TEXT | INTEGER | 在庫数（整数） |
| 保管場所在庫 | TEXT | INTEGER | 在庫数（整数） |
| 返品保管在庫 | TEXT | INTEGER | 在庫数（整数） |
| 保管返品在庫 | TEXT | INTEGER | 在庫数（整数） |

### 2. コード系フィールドの適切なTEXT化
以下のフィールドは正しくTEXT型：

| フィールド名 | 型 | 理由 |
|-------------|-----|------|
| 品目コード | TEXT | ゼロパディング保持が必要 |
| プラント | TEXT | コード値 |
| 保管場所 | TEXT | コード値（ゼロパディング） |

## 📈 修正提案

### 優先度: 高
1. **数値フィールドの型修正**
   ```sql
   -- 利用可能数量をREAL型に変更
   ALTER TABLE zs65 ADD COLUMN 利用可能数量_new REAL;
   UPDATE zs65 SET 利用可能数量_new = CAST(利用可能数量 AS REAL);
   ```

2. **整数フィールドの型修正**
   ```sql
   -- 在庫系フィールドをINTEGER型に変更
   ALTER TABLE zs65 ADD COLUMN 転送中在庫_new INTEGER;
   UPDATE zs65 SET 転送中在庫_new = CAST(転送中在庫 AS INTEGER);
   ```

### 優先度: 中
3. **Column Master更新**
   ```sql
   UPDATE column_master 
   SET data_type = 'REAL' 
   WHERE file_name = 'zs65.txt' AND column_name = '利用可能数量';
   ```

## 🎯 期待効果

### パフォーマンス向上
- **数値計算の高速化**: TEXT→数値型変換で計算処理が高速化
- **ストレージ効率**: 数値型の方がストレージ効率が良い
- **インデックス効率**: 数値型インデックスの方が高速

### データ品質向上
- **型安全性**: 数値フィールドに文字列が混入することを防止
- **計算精度**: 浮動小数点計算の精度向上
- **SQLクエリ**: 数値比較・集計クエリの正確性向上

## 🔧 実装手順

### Step 1: バックアップ作成
```bash
python t002_backup_system.py
```

### Step 2: 型修正実行
```bash
python t004_modification_engine.py --target zs65
```

### Step 3: 検証実行
```bash
python t007_verification_system.py --verify zs65
```

### Step 4: 結果確認
```bash
python data_type_comparison_tool.py
```

## 📊 検証結果予測

### 修正前
- **型一致率**: 100% (全てTEXT)
- **データ品質**: 低（数値計算不可）
- **パフォーマンス**: 低

### 修正後（予測）
- **型一致率**: 85-90%
- **データ品質**: 高（適切な型分離）
- **パフォーマンス**: 高（数値計算最適化）

## 🚨 注意事項

1. **データ変換エラー**: 数値に変換できない文字列データの存在可能性
2. **アプリケーション影響**: 既存のアプリケーションが型変更に対応しているか確認
3. **バックアップ必須**: 修正前に必ずバックアップを作成

## 📝 結論

zs65テーブルは**過度にTEXT型に統一**されており、数値系フィールドの適切な型修正が必要。
T004修正エンジンとT007検証システムを活用して段階的に修正することを推奨。

---
**作成者**: T007検証システム  
**承認**: データ管理チーム