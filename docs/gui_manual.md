  
# SQLite Data Manager GUI 操作マニュアル

## 1. 概要

このマニュアルは、Streamlitで構築された「SQLite Data Manager GUI」の操作方法を説明します。
本GUIは、SAP生産データの自動取り込み、型推定、正規化、および高度なデータ処理を行うSQLiteベースのデータ管理システムです。

## 2. GUIの起動方法

### 2.1. 基本起動
```bash
streamlit run streamlit_app.py
```

### 2.2. ポート指定起動（ポートが使用中の場合）
```bash
streamlit run streamlit_app.py --server.port 8503
```

起動後、Webブラウザで以下のURLにアクセス：
- ローカル: http://localhost:8501 (または指定ポート)
- ネットワーク: http://[IPアドレス]:8501

## 3. GUI構成と操作手順

### 3.1. サイドバー - 基本設定

#### 3.1.1. データベース初期化
- **開発用DB初期化**: テスト環境用のデータベースを初期化
- **本番用DB初期化**: 本番環境用のデータベースを初期化

#### 3.1.2. パターンルール管理
- **未登録ファイルルール**: 新しいファイル形式の設定
- **日付パターンルール**: 日付形式の追加・管理
- **ビジネスロジックルール**: コード、金額、数量フィールドの定義

### 3.2. メインエリア - データ処理

#### 3.2.1. 基本データ処理
1. **最新ルールを適用してマスタを更新**
   - パターンルールを全ファイルに適用
   - column_masterテーブルを更新

2. **データをテーブルにロード**
   - 定義されたスキーマでデータをSQLiteに読み込み

3. **マスタと比較して差分を検出**
   - 未登録列や型不一致を検出

#### 3.2.2. 高度なデータ処理機能

##### T003: 型統合レポート機能
- **型統合レポート生成**: データ型の統合状況を分析
- **修正候補の自動提案**: 型不一致の修正候補を提示

##### T004: 型修正エンジン
- **修正エンジン実行**: 自動型修正を実行
- **バックアップ作成**: 修正前のデータをバックアップ
- **修正履歴表示**: 過去の修正履歴を確認

##### T005: SAP特殊ルール
- **後ろマイナス検出**: SAP特有の後ろマイナス表記を検出
- **コード系フィールド識別**: コード系フィールドを自動識別
- **小数点カンマ検出**: 小数点カンマ表記を検出

##### T006: バッチ修正機能
- **CSV修正指示**: CSVファイルから修正指示を読み込み実行
- **修正指示CSVエクスポート**: 修正指示をCSV形式でエクスポート

##### T007: 検証システム
- **データ整合性検証**: データの整合性をチェック
- **実テーブル型比較**: 実テーブルとcolumn_masterを比較

#### 3.2.3. 重たい処理・業務処理
- **ZP138引当・過不足算出**: 90,000データの引当と過不足を算出

## 4. 推奨操作フロー

### 4.1. 初回セットアップ
1. データベース初期化（開発用または本番用）
2. パターンルール設定
3. 最新ルールを適用してマスタを更新

### 4.2. 日常業務フロー
1. データをテーブルにロード
2. 型統合レポート生成
3. 必要に応じて修正エンジン実行
4. データ整合性検証
5. ZP138処理実行（必要時）

### 4.3. トラブルシューティング
1. エラー発生時は、コンソール出力を確認
2. 特殊文字エラーの場合は、該当テーブルをスキップ
3. バックアップから復旧が可能

## 5. エラー対応

### 5.1. よくあるエラー
- **特殊文字エラー**: テーブル名に特殊文字が含まれる場合
- **型不一致エラー**: データ型の不整合
- **接続エラー**: データベース接続の問題

### 5.2. 対処方法
- エラーメッセージを確認
- ログファイルをチェック
- 必要に応じてバックアップから復旧

## 6. 注意事項

- 重たい処理（ZP138等）は数分かかる場合があります
- バックアップは定期的に作成してください
- エラーが発生した場合は、処理を中断して原因を確認してください

## 7. サポート

問題が発生した場合は、以下を確認してください：
1. コンソール出力のエラーメッセージ
2. ログファイルの内容
3. データベースの状態

このマニュアルで操作方法についてご理解いただけましたでしょうか？
追加の質問や不明な点があれば、お気軽にお申し付けください。