# SQLite Data Manager - Requirements

## 機能要件

### 必須機能 (Must Have)

#### 1. データ取り込み機能
- [ ] 複数ファイル形式対応 (CSV, TXT, XLS, XLSX)
- [ ] 自動エンコーディング検出 (UTF-8, CP932, Shift_JIS, UTF-16)
- [ ] 自動区切り文字検出 (カンマ, タブ, パイプ, セミコロン)
- [ ] エラー耐性のある読み込み処理
- [ ] 日次バッチ処理対応

#### 2. データ型推定・統合機能 ⭐ **最重要**
- [ ] 自動データ型推定 (INTEGER, REAL, TEXT, DATETIME)
- [ ] SAPデータ特殊ルール対応 (0パディング, 後ろマイナス)
- [ ] 同一データの重複検出・統合
- [ ] 手動型修正のサポート
- [ ] 型統合結果の永続化

#### 3. SQLite データベース管理
- [ ] 自動テーブル作成
- [ ] スキーマ管理
- [ ] データ品質チェック
- [ ] パフォーマンス最適化 (インデックス, VACUUM)

#### 4. 監視・ログ機能
- [ ] ファイル処理状況の記録
- [ ] エラーログの出力
- [ ] 処理統計の表示
- [ ] 異常検出アラート

### 推奨機能 (Should Have)

#### 5. データ型修正ツール
- [ ] 一括型修正機能
- [ ] 修正履歴の管理
- [ ] 修正ルールのテンプレート化
- [ ] プレビュー機能

#### 6. Web UI (Streamlit)
- [ ] データ概要ダッシュボード
- [ ] 型統合状況の可視化
- [ ] ファイル処理状況の表示
- [ ] 手動修正インターface

### 将来機能 (Nice to Have)

#### 7. 高度な分析機能
- [ ] データプロファイリング
- [ ] 異常値検出
- [ ] データ品質スコア算出
- [ ] トレンド分析

#### 8. 外部連携
- [ ] Excel エクスポート
- [ ] API 提供
- [ ] 他システムとの連携
- [ ] 通知機能 (Slack, Email)

## 非機能要件

### パフォーマンス要件
- **処理時間**: 40ファイル (合計2,400+フィールド) を10分以内で処理
- **メモリ使用量**: 8GB以下での動作
- **ファイルサイズ**: 単一ファイル最大500MB まで対応
- **同時処理**: 複数ファイルの並列処理対応

### 可用性要件
- **稼働時間**: 日次バッチ処理での高可用性
- **障害回復**: エラー発生時の自動継続処理
- **データ整合性**: 処理中断時のロールバック機能

### セキュリティ要件
- **データ保護**: 機密データの適切な取り扱い
- **アクセス制御**: ファイル・DB へのアクセス権限管理
- **ログ管理**: セキュリティログの出力

### 保守性要件
- **コード品質**: 型ヒント、ドキュメント文字列の完備
- **テスト**: ユニットテスト・統合テストの実装
- **設定管理**: 設定の外部化・環境依存の分離

## データ要件

### 入力データ仕様
```
フォーマット: CSV, TXT, XLS, XLSX
エンコーディング: UTF-8, CP932, Shift_JIS, UTF-16  
区切り文字: カンマ, タブ, パイプ, セミコロン
ファイルサイズ: 1KB ~ 500MB
更新頻度: 日次
ファイル数: 40+ (増加予定)
```

### 出力データ仕様
```
データベース: SQLite 3.x
テーブル数: ファイル数 + 管理テーブル
総フィールド数: 2,400+ (増加予定)
保存期間: 制限なし (手動削除まで)
```

## 制約条件

### 技術制約
- **プラットフォーム**: Windows 10/11
- **Python**: 3.8+
- **ライブラリ**: pandas, sqlite3, streamlit
- **ハードウェア**: メモリ8GB, ストレージ100GB+

### 業務制約
- **情シス側のデータ形式**: 変更不可 (統一性なし前提)
- **処理時間**: 業務時間外での実行
- **メンテナンス**: 月次メンテナンス枠あり

### 運用制約
- **バックアップ**: 手動バックアップ
- **障害対応**: 営業時間内での対応
- **変更管理**: Git によるバージョン管理

## 成功基準

### Phase 1 (データ型統合)
- [ ] 2,400フィールドの型統合完了率 95%以上
- [ ] 自動推定精度 90%以上  
- [ ] 手動修正工数 1週間以内

### Phase 2 (自動化)
- [ ] 日次バッチ処理の成功率 98%以上
- [ ] ファイル処理時間 10分以内
- [ ] エラー自動回復率 80%以上

### Phase 3 (ダッシュボード)
- [ ] レスポンス時間 3秒以内
- [ ] 使いやすさ評価 4/5以上
- [ ] ダッシュボード利用率 週3回以上

## リスク管理

### 高リスク
1. **データ型統合の複雑さ**: SAPデータの特殊性による作業量増大
2. **メモリ不足**: 大容量ファイル処理時のメモリ枯渇
3. **データ品質**: 情シス側データの品質低下

### 中リスク  
1. **パフォーマンス低下**: ファイル増加に伴う処理時間増大
2. **運用負荷**: メンテナンス作業の属人化
3. **技術的負債**: 急速開発による設計の劣化

### 対策
- 段階的開発によるリスク分散
- 十分なテスト・検証期間の確保
- ドキュメント整備による知識共有
